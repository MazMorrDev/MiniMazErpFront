[file name]: movements.html
[file content begin]
<app-navbar />

<div class="mov-inv-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Gestión de Movimientos</mat-card-title>
      <mat-card-subtitle>Compras, Ventas y Gastos</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Resumen Estadístico -->
      <div class="stats-grid">
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-item">
              <mat-icon color="primary">shopping_cart</mat-icon>
              <div class="stat-info">
                <h3>{{ movementStats().totalBuys }}</h3>
                <p>Compras</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-item">
              <mat-icon color="accent">point_of_sale</mat-icon>
              <div class="stat-info">
                <h3>{{ movementStats().totalSells }}</h3>
                <p>Ventas</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-item">
              <mat-icon color="warn">payments</mat-icon>
              <div class="stat-info">
                <h3>{{ movementStats().totalExpenses }}</h3>
                <p>Gastos</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-item">
              <mat-icon color="primary">attach_money</mat-icon>
              <div class="stat-info">
                <h3>${{ movementStats().totalBuysAmount + movementStats().totalExpensesAmount | number:'1.2-2' }}</h3>
                <p>Total Movimientos</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Form Section -->
      <mat-card class="form-card">
        <mat-card-header>
          <mat-card-title>Nuevo Movimiento</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="form" (ngSubmit)="add()" class="mov-form">
            <div class="form-grid">
              <!-- Tipo de Movimiento -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Tipo de Movimiento</mat-label>
                <mat-radio-group formControlName="movementType" class="radio-group">
                  @for (type of movementTypes(); track type.value) {
                    <mat-radio-button [value]="type.value" class="radio-button">
                      <mat-icon>{{type.icon}}</mat-icon> {{type.label}}
                    </mat-radio-button>
                  }
                </mat-radio-group>
              </mat-form-field>

              <!-- Producto -->
              <mat-form-field appearance="outline">
                <mat-label>Producto</mat-label>
                <mat-select formControlName="productId">
                  <mat-option [value]="null">-- Seleccionar Producto --</mat-option>
                  @for (product of products(); track product.id) {
                    <mat-option [value]="product.id">{{ product.name }}</mat-option>
                  }
                </mat-select>
                @if (form.get('productId')?.hasError('required')) {
                  <mat-error>Producto es requerido</mat-error>
                }
              </mat-form-field>

              <!-- Descripción -->
              <mat-form-field appearance="outline">
                <mat-label>Descripción</mat-label>
                <input matInput formControlName="description">
                @if (form.get('description')?.hasError('required')) {
                  <mat-error>Descripción es requerida</mat-error>
                }
              </mat-form-field>

              <!-- Cantidad -->
              <mat-form-field appearance="outline">
                <mat-label>Cantidad</mat-label>
                <input matInput type="number" min="1" formControlName="quantity">
                @if (form.get('quantity')?.hasError('required')) {
                  <mat-error>Cantidad es requerida</mat-error>
                }
                @if (form.get('quantity')?.hasError('min')) {
                  <mat-error>Cantidad mínima: 1</mat-error>
                }
              </mat-form-field>

              <!-- Fecha -->
              <mat-form-field appearance="outline">
                <mat-label>Fecha</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="movementDate">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                @if (form.get('movementDate')?.hasError('required')) {
                  <mat-error>Fecha es requerida</mat-error>
                }
              </mat-form-field>

              <!-- Campos específicos para COMPRA -->
              @if (form.get('movementType')?.value === 'BUY') {
                <mat-form-field appearance="outline">
                  <mat-label>Precio Unitario ($)</mat-label>
                  <input matInput type="number" min="0" step="0.01" formControlName="unitPrice">
                  @if (form.get('unitPrice')?.hasError('required')) {
                    <mat-error>Precio unitario es requerido</mat-error>
                  }
                  @if (form.get('unitPrice')?.hasError('min')) {
                    <mat-error>Precio no puede ser negativo</mat-error>
                  }
                </mat-form-field>
              }

              <!-- Campos específicos para GASTO -->
              @if (form.get('movementType')?.value === 'EXPENSE') {
                <mat-form-field appearance="outline">
                  <mat-label>Tipo de Gasto</mat-label>
                  <mat-select formControlName="expenseType">
                    @for (expType of expenseTypes(); track expType.value) {
                      <mat-option [value]="expType.value">{{ expType.label }}</mat-option>
                    }
                  </mat-select>
                  @if (form.get('expenseType')?.hasError('required')) {
                    <mat-error>Tipo de gasto es requerido</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Total Gasto ($)</mat-label>
                  <input matInput type="number" min="0" step="0.01" formControlName="totalPrice">
                  @if (form.get('totalPrice')?.hasError('required')) {
                    <mat-error>Total es requerido</mat-error>
                  }
                  @if (form.get('totalPrice')?.hasError('min')) {
                    <mat-error>Total no puede ser negativo</mat-error>
                  }
                </mat-form-field>
              }

              <!-- Acciones del Formulario -->
              <div class="form-actions full-width">
                <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
                  <mat-icon>add</mat-icon> Registrar Movimiento
                </button>
                <button mat-button type="button" (click)="resetForm()">
                  <mat-icon>clear</mat-icon> Limpiar
                </button>
              </div>
            </div>
          </form>
        </mat-card-content>
      </mat-card>

      <!-- Filtros -->
      <mat-card class="filters-card">
        <mat-card-header>
          <mat-card-title>Filtros</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="filters-grid">
            <mat-form-field appearance="outline">
              <mat-label>Filtrar por Producto</mat-label>
              <mat-select [value]="filters().productId" 
                         (selectionChange)="updateFilterProductId($event.value)">
                <mat-option [value]="undefined">Todos los Productos</mat-option>
                @for (product of products(); track product.id) {
                  <mat-option [value]="product.id">{{ product.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Filtrar por Tipo</mat-label>
              <mat-select [value]="filters().movementType" 
                         (selectionChange)="updateFilterMovementType($event.value)">
                <mat-option [value]="undefined">Todos los Tipos</mat-option>
                @for (type of movementTypes(); track type.value) {
                  <mat-option [value]="type.value">{{ type.label }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <div class="filter-actions">
              <button mat-button (click)="clearFilters()">
                <mat-icon>clear_all</mat-icon> Limpiar Filtros
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Historial de Movimientos -->
      @defer (on viewport) {
        <mat-card class="history-card">
          <mat-card-header>
            <mat-card-title>Historial de Movimientos</mat-card-title>
            <mat-card-subtitle>Total: {{ filteredMovements().length }} movimientos</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            @if (filteredMovements().length > 0) {
              <div class="table-container">
                <table mat-table [dataSource]="filteredMovements()" class="mat-elevation-z2">
                  <!-- Fecha -->
                  <ng-container matColumnDef="date">
                    <th mat-header-cell *matHeaderCellDef>Fecha</th>
                    <td mat-cell *matCellDef="let movement">
                      {{ formatDate(movement.movementDate) }}
                    </td>
                  </ng-container>

                  <!-- Producto -->
                  <ng-container matColumnDef="product">
                    <th mat-header-cell *matHeaderCellDef>Producto</th>
                    <td mat-cell *matCellDef="let movement">
                      {{ getProductName(movement) }}
                    </td>
                  </ng-container>

                  <!-- Tipo -->
                  <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef>Tipo</th>
                    <td mat-cell *matCellDef="let movement">
                      @let typeInfo = getMovementTypeInfo(movement);
                      @if (typeInfo) {
                        <span class="type-badge" [class]="'type-' + typeInfo.value.toLowerCase()">
                          <mat-icon>{{typeInfo.icon}}</mat-icon>
                          {{typeInfo.label}}
                        </span>
                      }
                    </td>
                  </ng-container>

                  <!-- Descripción -->
                  <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef>Descripción</th>
                    <td mat-cell *matCellDef="let movement">{{ movement.description }}</td>
                  </ng-container>

                  <!-- Cantidad -->
                  <ng-container matColumnDef="quantity">
                    <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                    <td mat-cell *matCellDef="let movement">{{ movement.quantity }}</td>
                  </ng-container>

                  <!-- Detalles -->
                  <ng-container matColumnDef="details">
                    <th mat-header-cell *matHeaderCellDef>Detalles</th>
                    <td mat-cell *matCellDef="let movement">
                      {{ getMovementDetails(movement) }}
                    </td>
                  </ng-container>

                  <!-- Acciones -->
                  <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Acciones</th>
                    <td mat-cell *matCellDef="let movement">
                      <button mat-icon-button color="warn" matTooltip="Eliminar" 
                              (click)="remove(movement)">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns();"></tr>
                </table>
              </div>
            } @else {
              <div class="no-data">
                <mat-icon>inventory_2</mat-icon>
                <p>No se encontraron movimientos</p>
              </div>
            }
          </mat-card-content>
        </mat-card>
      } @placeholder {
        <div class="placeholder">
          <mat-spinner [diameter]="40"></mat-spinner>
          <p>Cargando historial de movimientos...</p>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
[file content end]