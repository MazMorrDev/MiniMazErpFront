<div class="mov-inv-container">
  <!-- Toolbar -->
  <mat-card class="toolbar-card">
    <mat-card-content>
      <div class="toolbar-grid">
        <!-- Search -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar por producto o descripción</mat-label>
          <input matInput [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)" type="text"
            placeholder="Buscar...">
          <mat-icon matSuffix>search</mat-icon>
          @if (searchQuery()) {
          <button matSuffix mat-icon-button (click)="clearSearch()">
            <mat-icon>close</mat-icon>
          </button>
          }
        </mat-form-field>

        <!-- Botones de acción -->
        <div class="action-wrapper">
          <button mat-raised-button color="primary" (click)="openAddMovementDialog()" class="action-btn">
            <mat-icon>add</mat-icon> Nuevo Movimiento
          </button>
          <button mat-raised-button color="accent" (click)="loadAllMovements()" class="action-btn">
            <mat-icon>refresh</mat-icon> Actualizar
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="custom-spinner"></div>
    <p>Cargando movimientos...</p>
  </div>
  }

  <!-- Table -->
  @if (!isLoading() && filteredMovements().length > 0) {
  <mat-card class="table-card">
    <mat-card-content>
      <table mat-table [dataSource]="filteredMovements()" class="movements-table">

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let movement">{{ formatDate(movement.movementDate) }}</td>
        </ng-container>

        <!-- Product Column -->
        <ng-container matColumnDef="product">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let movement">{{ getProductName(movement) }}</td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Tipo</th>
          <td mat-cell *matCellDef="let movement">
            @let typeInfo = getMovementTypeInfo(movement);
            <span class="type-badge" [class]="'type-' + typeInfo.value.toLowerCase()">
              <mat-icon>{{ typeInfo.icon }}</mat-icon>
              {{ typeInfo.label }}
            </span>
          </td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Descripción</th>
          <td mat-cell *matCellDef="let movement">{{ movement.description || 'N/A' }}</td>
        </ng-container>

        <!-- Quantity Column -->
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef>Cantidad</th>
          <td mat-cell *matCellDef="let movement">{{ movement.quantity }}</td>
        </ng-container>

        <!-- Details Column -->
        <ng-container matColumnDef="details">
          <th mat-header-cell *matHeaderCellDef>Detalles</th>
          <td mat-cell *matCellDef="let movement">{{ getMovementDetails(movement) }}</td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let movement">
            <button mat-icon-button color="warn" (click)="remove(movement)" matTooltip="Eliminar">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns();"></tr>
      </table>
    </mat-card-content>
  </mat-card>
  }

  <!-- No Data -->
  @if (!isLoading() && filteredMovements().length === 0) {
  <mat-card class="empty-card">
    <mat-card-content>
      <div class="empty-state">
        <mat-icon>swap_horiz</mat-icon>
        <h3>No hay movimientos registrados</h3>
        @if (searchQuery()) {
        <p>No hay resultados para "{{ searchQuery() }}"</p>
        <button mat-button (click)="clearSearch()">Limpiar Búsqueda</button>
        } @else {
        <p>No hay movimientos disponibles</p>
        }
      </div>
    </mat-card-content>
  </mat-card>
  }
</div>